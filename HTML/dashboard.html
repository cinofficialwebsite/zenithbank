<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />

    <title>Dashboard</title>
    <link rel="stylesheet" href="/CSS/dashboard.css" />
    <link rel="stylesheet" href="/CSS/transfer.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <!-- SweetAlert2 CDN -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      #transaction-history {
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 10px;
        margin-top: 1rem;
        background-color: #f9f9f9;
      }

      .collapsed {
        display: none !important;
      }

      .transaction-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .transaction-item {
        background-color: #fff;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease;
      }

      .transaction-item:hover {
        transform: translateY(-3px);
      }

      .transaction-top {
        display: flex;
        justify-content: space-between;
        font-weight: bold;
      }

      .transaction-details {
        margin-top: 0.5rem;
        font-size: 0.9rem;
      }

      .status {
        padding: 0.2rem 0.6rem;
        border-radius: 8px;
        font-size: 0.75rem;
        text-transform: uppercase;
      }

      .status.pending {
        background-color: #fff3cd;
        color: #856404;
      }

      .status.success {
        background-color: #d4edda;
        color: #155724;
      }

      /* Responsive Design */
      @media screen and (max-width: 600px) {
        .transaction-top,
        .transaction-details {
          flex-direction: column;
          font-size: 0.85rem;
        }

        .transaction-top span {
          display: block;
          margin-bottom: 0.3rem;
        }
      }
    </style>
  </head>
  <body>
    <i
      id="mobile-menu-icon"
      class="fas fa-bars mobile-menu-icon"
      onclick="toggleSidebar()"
    ></i>

    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="user-info">
          <i
            id="menu-icon"
            class="fas fa-bars toggle-btn"
            onclick="toggleSidebar()"
          ></i>
          <div class="user-details">
            <p id="midandlastname">Loading......</p>
            <span class="username" id="username">Loading.....</span>
          </div>
        </div>
      </div>

      <ul class="sidebar-menu">
        <li onclick="activateMenu(this, 'overview')" class="active">
          <i class="fas fa-home"></i> <span class="menu-text">Overview</span>
        </li>
        <li onclick="activateMenu(this, 'transfer')">
          <i class="fas fa-exchange-alt"></i>
          <span class="menu-text">Transfer</span>
        </li>
        <li onclick="activateMenu(this, 'airtime')">
          <i class="fas fa-mobile-alt"></i>
          <span class="menu-text">Airtime Recharge</span>
        </li>
        <li onclick="activateMenu(this, 'bill')">
          <i class="fas fa-file-invoice"></i>
          <span class="menu-text">Bill Payment</span>
        </li>
        <li onclick="activateMenu(this, 'recurring')">
          <i class="fas fa-redo"></i>
          <span class="menu-text">Recurring Payments</span>
        </li>
        <li onclick="activateMenu(this, 'cards')">
          <i class="fas fa-credit-card"></i>
          <span class="menu-text">Cards & Cheques</span>
        </li>
        <li onclick="activateMenu(this, 'travel')">
          <i class="fas fa-plane"></i>
          <span class="menu-text">Travels & Leisure</span>
        </li>
        <li onclick="activateMenu(this, 'messages')">
          <i class="fas fa-envelope"></i>
          <span class="menu-text">Messages</span>
        </li>
        <li onclick="activateMenu(this, 'settings')">
          <i class="fas fa-cog"></i> <span class="menu-text">Settings</span>
        </li>
        <li onclick="activateMenu(this, 'zenith')">
          <i class="fas fa-map-marker-alt"></i>
          <span class="menu-text">Zenith Near Me</span>
        </li>
        <hr />
        <li onclick="activateMenu(this, 'zenith')" style="color: red">
          <i class="fa fa-power-off"></i>
          <span class="menu-text">Sign Out</span>
        </li>
      </ul>
    </div>

    <div class="content">
      <section id="overview" class="section active">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Overview</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">
          <!-- Slider Container -->
          <div class="slider-container">
            <div class="slide active-slide">
              <span class="slide-text"
                >Savings Account - <span id="accountNum">Loading...</span></span
              >
            </div>
            <div class="slide">
              <span class="slide-text">Slide 2: More Details</span>
            </div>
            <div class="slide">
              <span class="slide-text">Slide 3: Final Thoughts</span>
            </div>
            <div class="dots-container">
              <div class="dot active-dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
          </div>

          <hr class="section-divider1" />

          <!-- Full Name and Balance -->
          <div class="user-info">
            <p class="full-name" id="full-name">Loading ....</p>
            <p class="balance">
              <strong id="balance-amount">$0.00</strong>
              <i class="fa fa-eye" id="toggle-balance"></i>
            </p>
          </div>

          <!-- Ledger Account & History -->
          <div class="ledger-history">
            <p class="ledger-account" id="ledger-account">
              Ledger account: $0.00
            </p>
            <p class="history"><i class="fa fa-calendar"></i> History</p>
          </div>

          <!-- EaZyLinks Section -->
          <div class="eazy-links">
            <span class="section-title">eaZyLinks</span>
            <hr class="section-divider" />

            <div class="icon-row">
              <div class="icon-item">
                <i class="fa fa-money-bill-wave"></i>
                <p>QPayment</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-plane"></i>
                <p>Travel & Leisure</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-tv"></i>
                <p>Cable TV</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-credit-card"></i>
                <p>Cards</p>
              </div>
            </div>

            <hr class="section-divider" />

            <div class="icon-row">
              <div class="icon-item">
                <i class="fa fa-id-card"></i>
                <p>My BVN</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-clock"></i>
                <p>Scheduled Payment</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-cog"></i>
                <p>Customize EaZyLinks</p>
              </div>
              <div class="icon-item">
                <i class="fa fa-cogs"></i>
                <p>Settings</p>
              </div>
            </div>

            <hr class="section-divider" />

            <img
              src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR6dULpUYqTLtSuU-cpxXoHeh-SL3rQN0WTZw&s"
              alt="Banner"
              class="full-width-banner"
            />
          </div>
        </div>
      </section>

      <section id="transfer" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Transfer</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">
          <div class="transfer-container">
            <div class="transfer-header">
              <button id="transferHistoryBtn">Transfer History</button>
              <button id="refreshBtn">Refresh</button>
            </div>

            <div class="transfer-mode">
              <label>Select Transfer Mode</label>
              <div class="transfer-options-wrapper">
                <div class="transfer-options" id="transfer-options">
                  <button class="mode-btn active" data-mode="own">
                    üë§ Own Account
                  </button>
                  <button class="mode-btn" data-mode="zenith">
                    üè¶ Zenith Bank
                  </button>
                  <button class="mode-btn" data-mode="other">
                    üèõÔ∏è Other Banks
                  </button>
                  <button class="mode-btn" data-mode="foreign">
                    üåç Foreign Transfer
                  </button>
                  <button class="mode-btn" data-mode="beneficiary">
                    ‚ûï Open Account for Beneficiary
                  </button>
                </div>
                <button id="scrollRight">‚û°Ô∏è</button>
              </div>
            </div>

            <!-- Form Sections -->
            <form id="own" class="transfer-form active-form">
              <label for="account-type-own">Select source account</label>
              <select
                name="account-type"
                id="account-type-own"
                class="account-type-dropdown"
              >
                <option disabled selected>Loading account...</option>
              </select>

              <label>Amount</label>
              <input
                type="text"
                placeholder="0.00"
                required
                id="amount-input"
                name="amount"
              />

              <label>Account Number</label>
              <div class="input-container">
                <input
                  type="text"
                  id="accountNumber"
                  placeholder="Account Number"
                  maxlength="11"
                  name="accountNumberInputed"
                  required
                  oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                />
                <img
                  id="loadingGif"
                  src="Loading_icon.gif"
                  alt="Loading..."
                  style="display: none; width: 20px"
                />
              </div>
              <label>Transaction Description</label>
              <input type="text" placeholder="Description" />
              <button type="submit">Transfer</button>
            </form>

            <form id="zenith" class="transfer-form hidden">
              <label for="account-type-zenith">Select source account</label>
              <select
                name="account-type"
                id="account-type-zenith"
                class="account-type-dropdown"
              >
                <option disabled selected>Loading account...</option>
              </select>

              <label>Amount</label>
              <input
                type="text"
                placeholder="0.00"
                required
                id="amount-input"
                name="amount"
              />
              <label>Account Number</label>
              <div class="input-container">
                <input
                  type="text"
                  name="accountNumberInputed"
                  id="accountNumberZenith"
                  placeholder="Account Number"
                  maxlength="11"
                  required
                  oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                />
                <img
                  id="loadingGifZenith"
                  src="Loading_icon.gif"
                  alt="Loading..."
                  style="display: none; width: 20px"
                />
              </div>
              <label>Transaction Description</label>
              <input type="text" placeholder="Description" />
              <button type="submit">Transfer</button>
            </form>

            <form id="other" class="transfer-form hidden">
              <label for="account-type-other">Select source account</label>
              <select
                name="account-type"
                id="account-type-other"
                class="account-type-dropdown"
              >
                <option disabled selected>Loading account...</option>
              </select>
              <label>Amount</label>
              <input
                type="text"
                placeholder="0.00"
                required
                id="amount-input"
                name="amount"
              />
              <label>Beneficiary Account Number</label>
              <div class="input-container">
                <input
                  type="text"
                  id="otherAccount"
                  placeholder="Account Number"
                  maxlength="11"
                  name="accountNumberInputed"
                  required
                  oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                />
                <img
                  id="loadingGifOther"
                  src="Loading_icon.gif"
                  alt="Loading..."
                  style="display: none; width: 20px"
                />
              </div>
              <label>Select Bank</label>
              <select name="bank" id="bank-dropdown">
                <option value="1">First Bank</option>
                <option value="2">Access Bank</option>
                <option value="3">Guaranty Trust Bank</option>
                <option value="4">UBA</option>
                <option value="5">Stanbic IBTC</option>
              </select>
              <label>Transaction Description</label>
              <input type="text" placeholder="Description" />
              <button type="submit">Transfer</button>
            </form>

            <form id="foreign" class="transfer-form hidden">
              <label for="account-type-foreign ">Select source account</label>
              <select
                name="account-type"
                id="account-type-foreign"
                class="account-type-dropdown"
              >
                <option disabled selected>Loading account...</option>
              </select>
              <label>Amount (USD)</label>
              <input
                type="text"
                placeholder="0.00"
                required
                id="amount-input"
                name="amount"
              />
              <label>SWIFT Code</label>
              <input type="text" placeholder="e.g. DEUTDEFFXXX" required />
              <label>Bank Name</label>
              <input type="text" placeholder="Bank Name" required />
              <label>Account Number</label>
              <div class="input-container">
                <input
                  type="text"
                  id="accountNumberForeign"
                  placeholder="Account Number"
                  maxlength="11"
                  name="accountNumberInputed"
                  required
                  oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                />
                <img
                  id="loadingGifForeign"
                  src="Loading_icon.gif"
                  alt="Loading..."
                  style="display: none; width: 20px"
                />
              </div>
              <label>Country</label>
              <input type="text" placeholder="Country" required />
              <label>Transaction Purpose</label>
              <input type="text" placeholder="Payment reason" required />
              <button type="submit">Transfer</button>
            </form>

            <form id="beneficiary" class="transfer-form hidden">
              <label>Beneficiary Source Account Name</label>
              <input type="text" placeholder="Source Account" required />
              <label>Beneficiary Account Number</label>
              <div class="input-container">
                <input
                  type="text"
                  id="beneficiaryAccountNumber"
                  placeholder="Account Number"
                  maxlength="11"
                  name="accountNumberInputed"
                  required
                  oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                />
                <img
                  id="loadingGifBeneficiary"
                  src="Loading_icon.gif"
                  alt="Loading..."
                  style="display: none; width: 20px"
                />
              </div>
              <label>Beneficiary Name</label>
              <input type="text" placeholder="Full Name" required />
              <button type="submit">Save Beneficiary</button>

              <div id="noBeneficiaryNotice" class="no-beneficiary">
                <p>No beneficiary saved yet.</p>
                <button id="addBeneficiaryBtn">+</button>
              </div>

              <div id="beneficiaryDisplay" class="beneficiary-display">
                <!-- Filled dynamically -->
              </div>
            </form>

            <div id="transaction-history" class="collapsed">
              <h3>Transaction History</h3>
              <ul class="transaction-list" id="transaction-list">
                <!-- Example transaction item -->
                <li class="transaction-item">
                  <div class="transaction-top">
                    <span>Transfer to 1234567890</span>
                    <span class="status pending">Pending</span>
                  </div>
                  <div class="transaction-details">
                    <div>Amount: $100</div>
                    <div>Date: April 12, 2025</div>
                    <div>Txn ID: TXN123456</div>
                  </div>
                </li>
                <li class="transaction-item">
                  <div class="transaction-top">
                    <span>Transfer to 1234567890</span>
                    <span class="status pending">Pending</span>
                  </div>
                  <div class="transaction-details">
                    <div>Amount: $100</div>
                    <div>Date: April 12, 2025</div>
                    <div>Txn ID: TXN123456</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <!-- PIN Overlay -->
          <div id="pinOverlay" style="display: none" class="overlay">
            <div class="overlay-box">
              <h2>Enter Transaction PIN</h2>
              <div class="pin-inputs">
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin1"
                />
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin2"
                />
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin3"
                />
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin4"
                />
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin5"
                />
                <input
                  type="password"
                  maxlength="1"
                  class="pin-input"
                  name="pin6"
                />
              </div>
              <!-- <button id="submitPin">Submit</button> -->
            </div>
          </div>
        </div>
      </section>

      <section id="airtime" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Airtime Recharge</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Airtime Recharge Content</div>
      </section>

      <section id="bill" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Bill Payment</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Bill Payment Content</div>
      </section>

      <section id="recurring" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Recurring Payments</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Recurring Payments Content</div>
      </section>

      <section id="cards" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Cards & Cheques</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Cards & Cheques Content</div>
      </section>

      <section id="travel" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Travels & Leisure</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Travels & Leisure Content</div>
      </section>

      <section id="messages" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Messages</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Messages Content</div>
      </section>

      <section id="settings" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Settings</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Settings Content</div>
      </section>

      <section id="zenith" class="section">
        <div class="content-header">
          <nav class="section-nav">
            <span class="nav-text">Zenith Near Me</span>
          </nav>
          <img
            src="https://www.zenithbank.com/media/1400/zenith-bank-logo_1.png"
            alt="Logo"
            class="header-logo"
          />
        </div>
        <div class="content-body">Zenith Near Me Content</div>
      </section>
    </div>

    <div class="bottom-nav sidebar-menu">
      <li class="nav-item active" onclick="activateMenu(this, 'overview')">
        <i class="fa fa-list-ul"></i>
        <span>Overview</span>
      </li>
      <li class="nav-item" onclick="activateMenu(this, 'airtime')">
        <i class="fa fa-phone"></i>
        <span>Recharge</span>
      </li>
      <li class="nav-item" onclick="activateMenu(this, 'transfer')">
        <i class="fas fa-exchange-alt"></i>
        <span>Transfer</span>
      </li>
      <li class="nav-item" onclick="activateMenu(this, 'cards')">
        <i class="fas fa-credit-card"></i>
        <span style="margin-right: 0.4rem">Bill</span>
      </li>
    </div>

    <script>
      const transferForms = document.querySelectorAll(".transfer-form");
      const transactionHistory = document.getElementById("transaction-history");
      const transferHistoryBtn = document.getElementById("transferHistoryBtn");
      const transactionList = document.getElementById("transaction-list");
      const refreshBtn = document.getElementById("refreshBtn");

      // Function to generate a unique alphanumeric transaction ID (optional)
      function generateTransactionId() {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
        let transactionId = "Tf3xN5";
        for (let i = 0; i < 20; i++) {
          transactionId += chars.charAt(
            Math.floor(Math.random() * chars.length)
          );
        }
        return transactionId;
      }

      // Fetch transaction history from backend
      async function updateTransactionHistory() {
        const accountNumber = localStorage.getItem("currentAccount");
        if (!accountNumber) {
          console.error("No current account found in localStorage.");
          return;
        }

        try {
          const response = await fetch(
            `https://zenithbank-backend.onrender.com/api/users/transactions/${accountNumber}`
          );
          const transactions = await response.json();

          transactionList.innerHTML = ""; // Clear current list

          if (!Array.isArray(transactions) || transactions.length === 0) {
            transactionList.innerHTML = "<li>No transactions found.</li>";
            return;
          }

          transactions.forEach((transaction) => {
            const transactionItem = document.createElement("li");
            transactionItem.classList.add("transaction-item");
            transactionItem.innerHTML = `
              <div class="transaction-top">
                <span>Transfer to ${transaction.recipientAccount}</span>
                <span class="status ${transaction.status.toLowerCase()}">
                  ${transaction.status}
                </span>
              </div>
              <div class="transaction-details">
                <div>Amount: $${parseFloat(transaction.amount).toFixed(2)}</div>
                <div>Date: ${
                  transaction.date
                    ? new Date(transaction.date).toLocaleString()
                    : "Unknown"
                }</div>
                <div>Txn ID: ${transaction.transactionId}</div>
                <p>contact customer care</p>
              </div>
            `;
            transactionList.appendChild(transactionItem);
          });
        } catch (error) {
          console.error("Error fetching transaction history:", error);
          transactionList.innerHTML =
            "<li>Failed to load transaction history.</li>";
        }
      }

      // Toggle transaction history visibility
      transferHistoryBtn.addEventListener("click", function () {
        if (transactionHistory.classList.contains("collapsed")) {
          document.querySelector(".transfer-mode").style.display = "none";
          transferForms.forEach((form) => (form.style.display = "none"));
          transactionHistory.classList.remove("collapsed");
          transferHistoryBtn.textContent = "Close Transaction History";
          updateTransactionHistory(); // Refresh from server when shown
        } else {
        }
      });

      // Load transaction history from server on page load
      updateTransactionHistory();

      refreshBtn.addEventListener("click", function () {
        location.reload(); // Optional: collapse by reload
      });
    </script>

    <script src="/JS/dashboard.js"></script>
    <script src="/JS/transfer.js"></script>
  </body>
</html>
